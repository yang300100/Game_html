<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç†æ¸¸æˆ - ç½‘é¡µç‰ˆå®¢æˆ·ç«¯</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® + ç»Ÿä¸€å­—ä½“ */
        .message-container {
            white-space: pre-line;
            /* å°†\næ¸²æŸ“ä¸ºæ¢è¡Œ */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimSun", å®‹ä½“, serif;
        }

        body {
            background-color: #EDFCF3;
            /* COLOR_ROOT_BG ä¸»èƒŒæ™¯è‰² */
            padding: 12px;
            min-width: 800px;
        }

        /* ===== å…¨å±€é…è‰²å¸¸é‡ï¼ˆå®Œå…¨ä¿ç•™åŸé…ç½® ä¸€å­—æœªæ”¹ï¼‰===== */
        :root {
            --COLOR_ROOT_BG: #EDFCF3;
            --COLOR_FRAME_ALL_BG: #EDFCF3;
            --COLOR_MSG_PANEL_BG: #EDFCF3;
            --COLOR_MSG_PANEL_FG: #B890D4;

            --COLOR_TEXT_STATUS_DISCONNECT: #E785A6;
            --COLOR_TEXT_STATUS_CONNECT: #8BC8E8;
            --COLOR_TEXT_LABEL_TITLE: #5CA4D8;
            --COLOR_TEXT_TAB_TITLE: #B890D4;
            --COLOR_TEXT_BUTTON_NORMAL: #333333;
            --COLOR_TEXT_BUTTON_HOVER: #FFFFFF;

            --COLOR_MSG_SELF: #5CA4D8;
            --COLOR_MSG_SYSTEM: #9C6CD3;
            --COLOR_MSG_SUCCESS: #64B89C;
            --COLOR_MSG_ERROR: #E76474;
            --COLOR_MSG_TIP: #E8B569;
            --COLOR_MSG_DEFAULT: #555555;

            --COLOR_BTN_NORMAL_BG: #D9F1FC;
            --COLOR_BTN_HOVER_BG: #8BC8E8;
            --COLOR_ENTRY_BG: #FFFFFF;
            --COLOR_ENTRY_FG: #333333;
            --COLOR_ENTRY_SELECT_BG: #C8E2F0;
            --COLOR_FRAME_BORDER: #8BC8E8;
            --COLOR_SCROLL_BAR_BG: #E6F4EF;
            --COLOR_SCROLL_BAR_ACTIVE: #5CA4D8;
            --COLOR_TAB_SELECT_BG: #C8E2F0;
            --COLOR_TAB_NORMAL_BG: #E6F4EF;

            /* å¸ƒå±€ä¼˜åŒ–å˜é‡ */
            --BORDER_RADIUS: 8px;
            --SHADOW_SOFT: 0 3px 6px rgba(140, 200, 232, 0.2);
            --GAP_SMALL: 6px;
            --GAP_MEDIUM: 10px;
            --PANEL_HEADER_HEIGHT: 34px;
            /* é€‚é…æ”¾å¤§å­—ä½“å¾®è°ƒé«˜åº¦ */
        }

        /* ===== é¡¶éƒ¨çŠ¶æ€æ ï¼ˆå­—ä½“æ”¾å¤§ é€‚é…é«˜åº¦ï¼‰===== */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 44px;
            padding: 0 15px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            margin-bottom: var(--GAP_MEDIUM);
        }

        .status-text {
            font-size: 14px;
            color: var(--COLOR_TEXT_STATUS_DISCONNECT);
        }

        .control-buttons {
            display: flex;
            gap: var(--GAP_SMALL);
        }

        .btn {
            height: 34px;
            padding: 0 18px;
            border: none;
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_BTN_NORMAL_BG);
            color: var(--COLOR_TEXT_BUTTON_NORMAL);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .btn:hover {
            background-color: var(--COLOR_BTN_HOVER_BG);
            color: var(--COLOR_TEXT_BUTTON_HOVER);
            box-shadow: 0 2px 4px rgba(140, 200, 232, 0.3);
        }

        /* ===== ä¸»å†…å®¹åŒºï¼ˆå¼¹æ€§å¸ƒå±€ ä¸»æ¬¡åˆ†æ˜ æ— ä¿®æ”¹ï¼‰===== */
        .main-container {
            display: flex;
            gap: var(--GAP_MEDIUM);
            height: calc(100vh - 128px);
            margin-bottom: var(--GAP_MEDIUM);
        }

        .message-section {
            flex: 3;
            min-width: 400px;
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            background-color: var(--COLOR_FRAME_ALL_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .map-section {
            flex: 2;
            max-width: 500px;
            min-width: 350px;
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            background-color: var(--COLOR_FRAME_ALL_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .map-section.show {
            display: flex;
        }

        /* ===== é¢æ¿å¤´éƒ¨ï¼ˆå­—ä½“æ”¾å¤§ é€‚é…é«˜åº¦ï¼‰===== */
        .panel-header {
            height: var(--PANEL_HEADER_HEIGHT);
            padding: 0 12px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--COLOR_FRAME_BORDER);
        }

        .panel-icon {
            width: 18px;
            height: 18px;
            background-color: var(--COLOR_TEXT_LABEL_TITLE);
            border-radius: 4px;
            margin-right: 8px;
        }

        .panel-title {
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            font-weight: normal;
        }

        /* ===== æ¶ˆæ¯å†…å®¹åŒºï¼ˆæ ¸å¿ƒï¼æ¶ˆæ¯å­—ä½“æ”¾å¤§ é˜…è¯»æ›´èˆ’é€‚ï¼‰===== */
        .message-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            background-color: var(--COLOR_MSG_PANEL_BG);
            line-height: 1.7;
        }

        .message-content::-webkit-scrollbar {
            width: 6px;
            background-color: var(--COLOR_SCROLL_BAR_BG);
            border-radius: 3px;
        }

        .message-content::-webkit-scrollbar-thumb {
            background-color: var(--COLOR_SCROLL_BAR_ACTIVE);
            border-radius: 3px;
        }

        .msg-item {
            margin-bottom: 6px;
            font-size: 14px;
        }

        /* ===== åœ°å›¾å†…å®¹åŒºï¼ˆé€‰é¡¹å¡+æç¤ºæ–‡å­— å­—ä½“æ”¾å¤§ï¼‰===== */
        .map-tabs {
            height: var(--PANEL_HEADER_HEIGHT);
            display: flex;
            padding: 0 8px;
            gap: 4px;
            align-items: center;
            border-bottom: 1px solid var(--COLOR_FRAME_BORDER);
        }

        .tab-btn {
            padding: 6px 14px;
            border-radius: 6px;
            background-color: var(--COLOR_TAB_NORMAL_BG);
            color: var(--COLOR_TEXT_TAB_TITLE);
            font-size: 13px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background-color: var(--COLOR_TAB_SELECT_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
        }

        .map-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background-color: var(--COLOR_FRAME_ALL_BG);
        }

        .map-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        .map-error {
            font-size: 14px;
            color: var(--COLOR_MSG_ERROR);
        }

        /* ===== è¾“å…¥åŒºï¼ˆå­—ä½“æ”¾å¤§ è¾“å…¥æ¡†é€‚é… æ ¸å¿ƒäº¤äº’åŒºï¼‰===== */
        .input-area {
            height: 50px;
            display: flex;
            align-items: center;
            gap: var(--GAP_SMALL);
            padding: 0 15px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
        }

        .input-label {
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            white-space: nowrap;
        }

        .input-box {
            flex: 1;
            height: 38px;
            padding: 0 14px;
            border: 1px solid var(--COLOR_FRAME_BORDER);
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_ENTRY_BG);
            color: var(--COLOR_ENTRY_FG);
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }

        .input-box:focus {
            border-color: #6BB8E8;
            box-shadow: 0 0 0 2px rgba(140, 200, 232, 0.2);
        }

        .input-box::selection {
            background-color: var(--COLOR_ENTRY_SELECT_BG);
        }

        .send-btn {
            height: 38px;
            padding: 0 22px;
            border-radius: var(--BORDER_RADIUS);
        }

        /* ===== æœåŠ¡å™¨é…ç½®å¼¹çª—ï¼ˆæ‰€æœ‰æ–‡å­—æ”¾å¤§ æ“ä½œæ›´æ¸…æ™°ï¼‰===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal-box {
            width: 360px;
            padding: 25px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--COLOR_FRAME_BORDER);
        }

        .modal-title {
            font-size: 16px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-item {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            height: 38px;
            padding: 0 14px;
            border: 1px solid var(--COLOR_FRAME_BORDER);
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_ENTRY_BG);
            color: var(--COLOR_ENTRY_FG);
            font-size: 14px;
        }

        .modal-submit {
            width: 100%;
            height: 38px;
            border: none;
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_BTN_NORMAL_BG);
            color: var(--COLOR_TEXT_BUTTON_NORMAL);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-submit:hover {
            background-color: var(--COLOR_BTN_HOVER_BG);
            color: var(--COLOR_TEXT_BUTTON_HOVER);
        }
    </style>
</head>

<body>
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
        <div class="status-text" id="statusText">æœªè®¾ç½®æœåŠ¡å™¨ | ç­‰å¾…é…ç½®...</div>
        <div class="control-buttons">
            <button class="btn" id="configBtn">è®¾ç½®æœåŠ¡å™¨</button>
            <button class="btn" id="toggleMapBtn">æ˜¾ç¤ºåœ°å›¾</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- æ¶ˆæ¯é¢æ¿ -->
        <div class="message-section">
            <div class="panel-header">
                <div class="panel-icon"></div>
                <h3 class="panel-title">æ¸¸æˆæ¶ˆæ¯é¢æ¿</h3>
            </div>
            <div class="message-content" id="messageContent"></div>
        </div>

        <!-- åœ°å›¾é¢æ¿ -->
        <div class="map-section" id="mapSection">
            <div class="panel-header">
                <div class="panel-icon"></div>
                <h3 class="panel-title">æ¥¼å±‚åœ°å›¾</h3>
            </div>
            <div class="map-tabs" id="mapTabs">
                <button class="tab-btn active" data-map="floor1">ä¸€å±‚åœ°å›¾</button>
                <button class="tab-btn" data-map="floor2">äºŒå±‚åœ°å›¾</button>
                <button class="tab-btn" data-map="floorF1">åœ°ä¸‹ä¸€å±‚åœ°å›¾</button>
            </div>
            <div class="map-display" id="mapDisplay">
                <div class="map-error">è¯·é€‰æ‹©åœ°å›¾æ¥¼å±‚</div>
            </div>
        </div>
    </div>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="input-area">
        <label class="input-label">è¾“å…¥æŒ‡ä»¤:</label>
        <input type="text" class="input-box" id="inputBox" placeholder="è¾“å…¥æ¸¸æˆæŒ‡ä»¤ï¼Œå›è½¦å‘é€...">
        <button class="btn send-btn" id="sendBtn">å‘é€</button>
    </div>

    <!-- æœåŠ¡å™¨é…ç½®å¼¹çª— -->
    <div class="modal-overlay" id="configModal">
        <div class="modal-box">
            <h3 class="modal-title">æœåŠ¡å™¨é…ç½®</h3>
            <div class="form-item">
                <label class="form-label">æœåŠ¡å™¨IPåœ°å€</label>
                <input type="text" class="form-input" id="serverIp" value="127.0.0.1">
            </div>
            <div class="form-item">
                <label class="form-label">æœåŠ¡å™¨ç«¯å£</label>
                <input type="text" class="form-input" id="serverPort" value="9999">
            </div>
            <button class="modal-submit" id="confirmConfigBtn">ç¡®è®¤é…ç½®</button>
        </div>
    </div>

    <script>
        // ===== å…¨å±€é…ç½®ï¼ˆä¿ç•™åŸå‚æ•° æ— ä»»ä½•ä¿®æ”¹ï¼‰=====
        const MAP_PATHS = {
            "floor1": "map_floor1.png",
            "floor2": "map_floor2.png",
            "floorF1": "map_floorF1.png"
        };
        let isConnected = false;
        let currentHost = "127.0.0.1";
        let currentPort = 9999;
        let currentMap = "floor1";
        let ws = null; // æ–°å¢ï¼šWebSocketè¿æ¥å¯¹è±¡ï¼Œæ›¿ä»£åŸè½®è¯¢å®šæ—¶å™¨

        // ===== DOMå…ƒç´ è·å– =====
        const statusText = document.getElementById("statusText");
        const configBtn = document.getElementById("configBtn");
        const toggleMapBtn = document.getElementById("toggleMapBtn");
        const messageContent = document.getElementById("messageContent");
        const mapSection = document.getElementById("mapSection");
        const mapTabs = document.getElementById("mapTabs");
        const mapDisplay = document.getElementById("mapDisplay");
        const inputBox = document.getElementById("inputBox");
        const sendBtn = document.getElementById("sendBtn");
        const configModal = document.getElementById("configModal");
        const serverIp = document.getElementById("serverIp");
        const serverPort = document.getElementById("serverPort");
        const confirmConfigBtn = document.getElementById("confirmConfigBtn");

        // ===== é¡µé¢åˆå§‹åŒ– =====
        window.addEventListener("load", () => {
            loadMap(currentMap);
            bindEvents();
        });

        // ===== äº‹ä»¶ç»‘å®š =====
        function bindEvents() {
            configBtn.addEventListener("click", () => {
                if (isConnected) {
                    disconnectServer();
                } else {
                    openConfigModal();
                }
            });

            toggleMapBtn.addEventListener("click", () => {
                mapSection.classList.toggle("show");
                toggleMapBtn.innerHTML = mapSection.classList.contains("show") ? "éšè—åœ°å›¾" : "æ˜¾ç¤ºåœ°å›¾";
            });

            mapTabs.querySelectorAll(".tab-btn").forEach(tab => {
                tab.addEventListener("click", () => {
                    mapTabs.querySelectorAll(".tab-btn").forEach(t => t.classList.remove("active"));
                    tab.classList.add("active");
                    currentMap = tab.dataset.map;
                    loadMap(currentMap);
                });
            });

            sendBtn.addEventListener("click", sendMessage);
            inputBox.addEventListener("keydown", (e) => {
                if (e.key === "Enter") sendMessage();
            });

            confirmConfigBtn.addEventListener("click", confirmConfig);

            configModal.addEventListener("click", (e) => {
                if (e.target === configModal) closeConfigModal();
            });

            // æ–°å¢ï¼šESCé”®å…³é—­é…ç½®å¼¹çª—
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && configModal.style.display === "flex") {
                    closeConfigModal();
                }
            });
        }

        // ===== åœ°å›¾åŠ è½½ =====
        function loadMap(mapKey) {
            // æ–°å¢ï¼šåŠ è½½ä¸­æç¤º
            mapDisplay.innerHTML = `<div class="map-error">æ­£åœ¨åŠ è½½åœ°å›¾...</div>`;
            const imgPath = MAP_PATHS[mapKey];
            const img = new Image();
            img.src = imgPath;
            img.className = "map-img";

            img.onload = () => {
                mapDisplay.innerHTML = "";
                mapDisplay.appendChild(img);
            };

            img.onerror = () => {
                mapDisplay.innerHTML = `<div class="map-error">åœ°å›¾åŠ è½½å¤±è´¥ï¼šæ–‡ä»¶ä¸å­˜åœ¨ ${imgPath}</div>`;
                addMessage(`âš ï¸ ${mapTabs.querySelector(`[data-map="${mapKey}"]`).textContent} åŠ è½½å¼‚å¸¸`, "error");
            };
        }

        // ===== æ¶ˆæ¯æ·»åŠ ï¼ˆå®Œå…¨ä¿ç•™åŸé…è‰²å’Œé€»è¾‘ ä¸€å­—æœªæ”¹ï¼‰=====
        function addMessage(msg, type = "default") {
            const colorMap = {
                self: "#5CA4D8",
                system: "#9C6CD3",
                success: "#64B89C",
                error: "#E76474",
                tip: "#E8B569",
                default: "#555555"
            };

            const msgItem = document.createElement("div");
            msgItem.className = "msg-item";
            msgItem.style.color = colorMap[type];
            msgItem.innerHTML = msg;

            messageContent.appendChild(msgItem);
            messageContent.scrollTop = messageContent.scrollHeight;
        }

        // ===== æœåŠ¡å™¨é…ç½®å¼¹çª— =====
        function openConfigModal() {
            serverIp.value = currentHost;
            serverPort.value = currentPort;
            configModal.style.display = "flex";
        }

        function closeConfigModal() {
            configModal.style.display = "none";
        }

        function confirmConfig() {
            const newHost = serverIp.value.trim();
            const newPort = serverPort.value.trim();

            if (!newHost) {
                alert("IPåœ°å€ä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            const portNum = parseInt(newPort);
            if (isNaN(portNum) || portNum < 1 || portNum > 65535) {
                alert("ç«¯å£å·å¿…é¡»æ˜¯1-65535çš„æ•´æ•°ï¼");
                return;
            }

            currentHost = newHost;
            currentPort = portNum;
            statusText.textContent = `å·²é…ç½®æœåŠ¡å™¨ ${currentHost}:${currentPort} | æœªè¿æ¥`;
            statusText.style.color = "#E785A6";
            addMessage(`âœ… æœåŠ¡å™¨é…ç½®å®Œæˆï¼š${currentHost}:${currentPort}`, "success");
            closeConfigModal();

            alert("ç‚¹å‡»ç¡®å®šå°è¯•è¿æ¥æœåŠ¡å™¨");
            connectServer();
        }

        // ===== ã€æ ¸å¿ƒä¿®æ”¹ã€‘WebSocket çœŸå®è¿æ¥é€»è¾‘ =====
        function connectServer() {
            if (isConnected) {
                alert("å·²è¿æ¥æœåŠ¡å™¨ï¼Œæ— éœ€é‡å¤è¿æ¥ï¼");
                return;
            }
            // åˆ›å»ºWebSocketè¿æ¥
            ws = new WebSocket(`ws://${currentHost}:${currentPort}`);

            // è¿æ¥æˆåŠŸå›è°ƒ
            ws.onopen = () => {
                isConnected = true;
                configBtn.textContent = "æ–­å¼€è¿æ¥";
                statusText.textContent = `å·²è¿æ¥æœåŠ¡å™¨ ${currentHost}:${currentPort} | æ¸¸æˆä¸­`;
                statusText.style.color = "#8BC8E8";
                addMessage(`âœ… æˆåŠŸè¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨ ${currentHost}:${currentPort}ï¼`, "success");
                addMessage(`ğŸ’¡ å¯ä»¥å¼€å§‹è¾“å…¥æ¸¸æˆæŒ‡ä»¤å•¦ï¼`, "tip");
            };

            // æ¥æ”¶åç«¯æ¶ˆæ¯å›è°ƒ
            ws.onmessage = (event) => {
                const recvMsg = event.data.trim();
                if (!recvMsg) return;
                // ä¿ç•™åŸæ¶ˆæ¯ç€è‰²é€»è¾‘
                if (recvMsg.includes("ç³»ç»Ÿå…¬å‘Š") || recvMsg.includes("æ¸¸æˆç»“æŸ")) {
                    addMessage(recvMsg, "system");
                } else if (recvMsg.includes("æˆåŠŸ") || recvMsg.includes("è·å¾—") || recvMsg.includes("å·²åˆ°è¾¾")) {
                    addMessage(recvMsg, "success");
                } else if (recvMsg.includes("å¤±è´¥") || recvMsg.includes("æ­»äº¡") || recvMsg.includes("ä¸å¯")) {
                    addMessage(recvMsg, "error");
                } else if (recvMsg.includes("è¯·") || recvMsg.includes("è¾“å…¥") || recvMsg.includes("å¯é€‰")) {
                    addMessage(recvMsg, "tip");
                } else if (recvMsg) {
                    addMessage(recvMsg, "default");
                }
            };

            // è¿æ¥å…³é—­å›è°ƒ
            ws.onclose = () => {
                disconnectServer();
                addMessage("âš ï¸ æœåŠ¡å™¨è¿æ¥å·²æ–­å¼€ï¼ˆç½‘ç»œå¼‚å¸¸/æœåŠ¡å™¨å…³é—­ï¼‰", "error");
            };

            // è¿æ¥å¤±è´¥å›è°ƒ
            ws.onerror = (error) => {
                isConnected = false;
                configBtn.textContent = "è®¾ç½®æœåŠ¡å™¨";
                statusText.textContent = `è¿æ¥å¤±è´¥ ${currentHost}:${currentPort} | è¯·æ£€æŸ¥é…ç½®`;
                statusText.style.color = "#E785A6";
                addMessage(`âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼š${currentHost}:${currentPort}ï¼Œè¯·æ£€æŸ¥IP/ç«¯å£æˆ–æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨`, "error");
            };
        }

        // ===== ã€æ ¸å¿ƒä¿®æ”¹ã€‘æ–­å¼€è¿æ¥é€»è¾‘ =====
        function disconnectServer() {
            if (isConnected && ws) {
                ws.close();
                ws = null;
            }
            isConnected = false;
            configBtn.textContent = "è®¾ç½®æœåŠ¡å™¨";
            statusText.textContent = `å·²é…ç½®æœåŠ¡å™¨ ${currentHost}:${currentPort} | å·²æ–­å¼€`;
            statusText.style.color = "#E785A6";
            addMessage("âŒ å·²æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥", "error");
        }

        // ===== ã€æ ¸å¿ƒä¿®æ”¹ã€‘å‘é€æŒ‡ä»¤é€»è¾‘ =====
        function sendMessage() {
            const msg = inputBox.value.trim();
            if (!msg) {
                alert("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            if (!isConnected) {
                alert("è¯·å…ˆé…ç½®å¹¶è¿æ¥æœåŠ¡å™¨å†å‘é€æŒ‡ä»¤ï¼");
                return;
            }

            try {
                // WebSocketå‘é€çº¯æ–‡æœ¬ï¼ŒåŠ æ¢è¡Œç¬¦é€‚é…Python readline
                ws.send(msg + "\n");
                addMessage(`ä½ ï¼š${msg}`, "self");
                inputBox.value = "";
                // æ–°å¢ï¼šå‘é€åè‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
                inputBox.focus();
            } catch (e) {
                addMessage(`âŒ å‘é€æŒ‡ä»¤å¤±è´¥ï¼šè¿æ¥å·²æ–­å¼€ï¼Œè¯·é‡æ–°è¿æ¥`, "error");
            }
        }
    </script>
</body>

</html>