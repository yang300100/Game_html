<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç†æ¸¸æˆ - ç½‘é¡µç‰ˆå®¢æˆ·ç«¯</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® + ç»Ÿä¸€å­—ä½“ */
        .message-container {
            white-space: pre-line;
            /* å°†\næ¸²æŸ“ä¸ºæ¢è¡Œ */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "SimSun", å®‹ä½“, serif;
        }

        body {
            background-color: #EDFCF3;
            padding: 12px;
            min-width: 1000px;
            width: 100vw;
            /* å®½åº¦é“ºæ»¡è§†å£ */
            height: 100vh;
            /* é«˜åº¦é“ºæ»¡è§†å£ */
            overflow: hidden !important;
            /* å½»åº•ç¦ç”¨æ»šåŠ¨æ¡ï¼Œæœ€å…³é”® */
        }

        /* ===== å…¨å±€é…è‰²å¸¸é‡ï¼ˆå®Œå…¨ä¿ç•™åŸé…ç½® ä¸€å­—æœªæ”¹ï¼‰===== */
        :root {
            --COLOR_ROOT_BG: #EDFCF3;
            --COLOR_FRAME_ALL_BG: #EDFCF3;
            --COLOR_MSG_PANEL_BG: #EDFCF3;
            --COLOR_MSG_PANEL_FG: #B890D4;

            --COLOR_TEXT_STATUS_DISCONNECT: #E785A6;
            --COLOR_TEXT_STATUS_CONNECT: #8BC8E8;
            --COLOR_TEXT_LABEL_TITLE: #5CA4D8;
            --COLOR_TEXT_TAB_TITLE: #B890D4;
            --COLOR_TEXT_BUTTON_NORMAL: #333333;
            --COLOR_TEXT_BUTTON_HOVER: #FFFFFF;

            --COLOR_MSG_SELF: #5CA4D8;
            --COLOR_MSG_SYSTEM: #9C6CD3;
            --COLOR_MSG_SUCCESS: #64B89C;
            --COLOR_MSG_ERROR: #E76474;
            --COLOR_MSG_TIP: #E8B569;
            --COLOR_MSG_DEFAULT: #555555;

            --COLOR_BTN_NORMAL_BG: #D9F1FC;
            --COLOR_BTN_HOVER_BG: #8BC8E8;
            --COLOR_ENTRY_BG: #FFFFFF;
            --COLOR_ENTRY_FG: #333333;
            --COLOR_ENTRY_SELECT_BG: #C8E2F0;
            --COLOR_FRAME_BORDER: #8BC8E8;
            --COLOR_SCROLL_BAR_BG: #E6F4EF;
            --COLOR_SCROLL_BAR_ACTIVE: #5CA4D8;
            --COLOR_TAB_SELECT_BG: #C8E2F0;
            --COLOR_TAB_NORMAL_BG: #E6F4EF;

            /* å¸ƒå±€ä¼˜åŒ–å˜é‡ */
            --BORDER_RADIUS: 8px;
            --SHADOW_SOFT: 0 3px 6px rgba(140, 200, 232, 0.2);
            --GAP_SMALL: 6px;
            --GAP_MEDIUM: 10px;
            --PANEL_HEADER_HEIGHT: 34px;
        }

        /* ===== é¡¶éƒ¨çŠ¶æ€æ  ===== */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 44px;
            padding: 0 15px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            margin-bottom: var(--GAP_MEDIUM);
        }

        .status-text {
            font-size: 14px;
            color: var(--COLOR_TEXT_STATUS_DISCONNECT);
        }

        .control-buttons {
            display: flex;
            gap: var(--GAP_SMALL);
        }

        .btn {
            height: 34px;
            padding: 0 18px;
            border: none;
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_BTN_NORMAL_BG);
            color: var(--COLOR_TEXT_BUTTON_NORMAL);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .btn:hover {
            background-color: var(--COLOR_BTN_HOVER_BG);
            color: var(--COLOR_TEXT_BUTTON_HOVER);
            box-shadow: 0 2px 4px rgba(140, 200, 232, 0.3);
        }

        /* ===== ä¸»å†…å®¹åŒº ä¸‰åˆ—å¼¹æ€§å¸ƒå±€ï¼šå·¦æ¶ˆæ¯ã€å³(ä¸Šåœ°å›¾+ä¸‹ç©æ³•) ===== */
        .main-container {
            display: flex;
            gap: var(--GAP_MEDIUM);
            /* ç²¾å‡†è®¡ç®—é«˜åº¦ï¼Œæ‰£é™¤çŠ¶æ€æ ã€é—´è·ã€è¾“å…¥æ¡†ã€å†…è¾¹è·ï¼Œå®Œç¾é€‚é…å…¨å±æ— æº¢å‡º */
            height: calc(100vh - 44px - var(--GAP_MEDIUM) - 50px - var(--GAP_MEDIUM) - 24px);
            margin-bottom: var(--GAP_MEDIUM);
        }

        .message-section {
            flex: 3;
            min-width: 400px;
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            background-color: var(--COLOR_FRAME_ALL_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .right-section {
            flex: 2;
            min-width: 350px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: var(--GAP_MEDIUM);
        }

        /* âœ… æ¢å¤åŸå§‹æ ·å¼ï¼šåœ°å›¾é¢æ¿è‡ªé€‚åº”é«˜åº¦ï¼Œä¸å†å¼ºåˆ¶16:9ï¼Œå®Œç¾è‡ªé€‚åº”çˆ¶å®¹å™¨ */
        .map-section {
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            background-color: var(--COLOR_FRAME_ALL_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            width: 100%;
            flex: 1;
        }

        /* ===== æ¸¸æˆç©æ³•é¢æ¿ ===== */
        .rule-section {
            flex: 1;
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
            background-color: var(--COLOR_FRAME_ALL_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .rule-content {
            flex: 1;
            padding: 12px 15px;
            overflow-y: auto;
            background-color: var(--COLOR_MSG_PANEL_BG);
            line-height: 1.7;
            font-size: 13px;
            color: var(--COLOR_MSG_DEFAULT);
        }

        .rule-content h4 {
            color: var(--COLOR_TEXT_LABEL_TITLE);
            font-size: 14px;
            margin: 8px 0 4px 0;
        }

        .rule-content p {
            margin: 3px 0;
        }

        .rule-content::-webkit-scrollbar {
            width: 6px;
            background-color: var(--COLOR_SCROLL_BAR_BG);
            border-radius: 3px;
        }

        .rule-content::-webkit-scrollbar-thumb {
            background-color: var(--COLOR_SCROLL_BAR_ACTIVE);
            border-radius: 3px;
        }

        /* ===== é¢æ¿å¤´éƒ¨ ===== */
        .panel-header {
            height: var(--PANEL_HEADER_HEIGHT);
            padding: 0 12px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--COLOR_FRAME_BORDER);
            width: 100%;
            flex-shrink: 0;
        }

        .panel-icon {
            width: 18px;
            height: 18px;
            background-color: var(--COLOR_TEXT_LABEL_TITLE);
            border-radius: 4px;
            margin-right: 8px;
        }

        .panel-title {
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            font-weight: normal;
        }

        /* ===== æ¶ˆæ¯å†…å®¹åŒº ===== */
        .message-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            background-color: var(--COLOR_MSG_PANEL_BG);
            line-height: 1.7;
        }

        .message-content::-webkit-scrollbar {
            width: 6px;
            background-color: var(--COLOR_SCROLL_BAR_BG);
            border-radius: 3px;
        }

        .message-content::-webkit-scrollbar-thumb {
            background-color: var(--COLOR_SCROLL_BAR_ACTIVE);
            border-radius: 3px;
        }

        .msg-item {
            margin-bottom: 6px;
            font-size: 14px;
        }

        /* ===== åœ°å›¾å†…å®¹åŒº ===== */
        .map-tabs {
            height: var(--PANEL_HEADER_HEIGHT);
            display: flex;
            padding: 0 8px;
            gap: 4px;
            align-items: center;
            border-bottom: 1px solid var(--COLOR_FRAME_BORDER);
            flex-shrink: 0;
        }

        .tab-btn {
            padding: 6px 14px;
            border-radius: 6px;
            background-color: var(--COLOR_TAB_NORMAL_BG);
            color: var(--COLOR_TEXT_TAB_TITLE);
            font-size: 13px;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background-color: var(--COLOR_TAB_SELECT_BG);
            border: 1px solid var(--COLOR_FRAME_BORDER);
        }

        /* âœ… åœ°å›¾æ˜¾ç¤ºåŒºï¼šé“ºæ»¡çˆ¶å®¹å™¨ï¼Œåªåšå±…ä¸­ï¼Œä¸è®¾æ¯”ä¾‹ */
        .map-display {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background-color: var(--COLOR_FRAME_ALL_BG);
            width: 100%;
        }

        /* â˜…â˜…â˜… â˜…â˜…â˜… æ ¸å¿ƒå…³é”®æ ·å¼ ã€å”¯ä¸€ä¿®æ”¹ç‚¹ã€‘â˜…â˜…â˜… â˜…â˜…â˜… */
        /* âœ… ä½ è¦çš„æ•ˆæœï¼š.map-ratio-16-9 è¿™ä¸ªå®¹å™¨ å¼ºåˆ¶ ä¸¥æ ¼ 16:9 å®½é«˜æ¯”ï¼Œæ°¸ä¸æ”¹å˜ */
        .map-ratio-16-9 {
            width: 100%;
            position: relative;
            padding-bottom: 56.25%;
            /* 16:9 é»„é‡‘å…¬å¼ 9/16 = 56.25% é”æ­»å®½é«˜æ¯” */
            height: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* âœ… åœ°å›¾å›¾ç‰‡ï¼šåœ¨16:9çš„å®¹å™¨å†…ç»å¯¹å±…ä¸­ã€ç­‰æ¯”ç¼©æ”¾ã€ä¸å˜å½¢ã€ä¸æ‹‰ä¼¸ã€ä¸è£å‰ª */
        .map-img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }

        /* é”™è¯¯æç¤ºæ–‡å­—å±…ä¸­ */
        .map-error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: var(--COLOR_MSG_ERROR);
            text-align: center;
        }

        /* ===== è¾“å…¥åŒº ===== */
        .input-area {
            height: 50px;
            display: flex;
            align-items: center;
            gap: var(--GAP_SMALL);
            padding: 0 15px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: var(--SHADOW_SOFT);
        }

        .input-label {
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            white-space: nowrap;
        }

        .input-box {
            flex: 1;
            height: 38px;
            padding: 0 14px;
            border: 1px solid var(--COLOR_FRAME_BORDER);
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_ENTRY_BG);
            color: var(--COLOR_ENTRY_FG);
            font-size: 14px;
            cursor: text;
            outline: none;
            transition: all 0.2s ease;
        }

        .input-box:focus {
            border-color: #6BB8E8;
            box-shadow: 0 0 0 2px rgba(140, 200, 232, 0.2);
        }

        .input-box::selection {
            background-color: var(--COLOR_ENTRY_SELECT_BG);
        }

        .send-btn {
            height: 38px;
            padding: 0 22px;
            border-radius: var(--BORDER_RADIUS);
        }

        /* ===== æœåŠ¡å™¨é…ç½®å¼¹çª— ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal-box {
            width: 360px;
            padding: 25px;
            background-color: var(--COLOR_ROOT_BG);
            border-radius: var(--BORDER_RADIUS);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--COLOR_FRAME_BORDER);
        }

        .modal-title {
            font-size: 16px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-item {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            color: var(--COLOR_TEXT_LABEL_TITLE);
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            height: 38px;
            padding: 0 14px;
            border: 1px solid var(--COLOR_FRAME_BORDER);
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_ENTRY_BG);
            color: var(--COLOR_ENTRY_FG);
            font-size: 14px;
        }

        .modal-submit {
            width: 100%;
            height: 38px;
            border: none;
            border-radius: var(--BORDER_RADIUS);
            background-color: var(--COLOR_BTN_NORMAL_BG);
            color: var(--COLOR_TEXT_BUTTON_NORMAL);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-submit:hover {
            background-color: var(--COLOR_BTN_HOVER_BG);
            color: var(--COLOR_TEXT_BUTTON_HOVER);
        }
    </style>
</head>

<body>
    <!-- é¡¶éƒ¨çŠ¶æ€æ  æ— åœ°å›¾æŒ‰é’® -->
    <div class="status-bar">
        <div class="status-text" id="statusText">æœªè®¾ç½®æœåŠ¡å™¨ | ç­‰å¾…é…ç½®...</div>
        <div class="control-buttons">
            <button class="btn" id="configBtn">è®¾ç½®æœåŠ¡å™¨</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <div class="message-section">
            <div class="panel-header">
                <div class="panel-icon"></div>
                <h3 class="panel-title">æ¸¸æˆæ¶ˆæ¯é¢æ¿</h3>
            </div>
            <div class="message-content" id="messageContent"></div>
        </div>

        <div class="right-section">
            <div class="map-section" id="mapSection">
                <div class="panel-header">
                    <div class="panel-icon"></div>
                    <h3 class="panel-title">æ¥¼å±‚åœ°å›¾</h3>
                </div>
                <div class="map-tabs" id="mapTabs">
                    <button class="tab-btn active" data-map="floor1">ä¸€å±‚åœ°å›¾</button>
                    <button class="tab-btn" data-map="floor2">äºŒå±‚åœ°å›¾</button>
                    <button class="tab-btn" data-map="floorF1">åœ°ä¸‹ä¸€å±‚åœ°å›¾</button>
                </div>
                <!-- åœ°å›¾åŒº -->
                <div class="map-display" id="mapDisplay">
                    <div class="map-ratio-16-9">
                        <div class="map-error">æ­£åœ¨åŠ è½½åœ°å›¾...</div>
                    </div>
                </div>
            </div>

            <div class="rule-section">
                <div class="panel-header">
                    <div class="panel-icon"></div>
                    <h3 class="panel-title">æ¸¸æˆç©æ³•è¯´æ˜</h3>
                </div>
                <div class="rule-content" id="ruleContent">
                    <h4>æ¸¸æˆèƒŒæ™¯è¯´æ˜</h4>
                    <p>1. ç©å®¶ä½œä¸ºé­”å¥³é¢„å¤‡å½¹è¢«å›šç¦äºè¿™åº§ç›‘ç‰¢å†…ï¼Œæ­¤ç›‘ç‰¢çš„ä½œç”¨ä¸ºæ‰¾å‡ºé­”å¥³å¹¶è¿›è¡Œå¤„å†³</p>
                    <p>2. å…¶ä¸­ä¸€åç©å®¶ä¼šå—åˆ°åˆºæ¿€ä»è€Œè½¬åŒ–ä¸ºé­”å¥³ï¼Œé­”å¥³å…·æœ‰å¾ˆå¼ºçš„æ”»å‡»æ€§ï¼ŒåŒæ—¶ä¿ç•™ç€äººç±»çš„ç†æ™º</p>
                    <p>3. è¯·å„ä½ç©å®¶æ‰¾å‡ºé­”å¥³å¹¶è¿›è¡Œå¤„å†³ï¼Œé­”å¥³è¯·éšè—å¥½è‡ªå·±çš„èº«ä»½ï¼Œé¿å…è¢«è®¤å‡º</p>

                    <h4>æ¸¸æˆæµç¨‹</h4>
                    <p>1. åœ¨å¼€å§‹æ—¶ï¼Œç©å®¶å¯ä»¥è‡ªç”±æ¢ç´¢ç›‘ç‰¢ï¼ŒåŒæ—¶é­”å¥³å¯ä»¥åœ¨æ­¤æ—¶é€‰æ‹©ä¸€åç›®æ ‡å¹¶æ€å®³</p>
                    <p>2. å½“å…¶ä»–ç©å®¶å‘ç°è¢«æ€å®³çš„å°¸ä½“æ—¶ï¼Œå°†è¿›å…¥æœè¯é˜¶æ®µï¼Œæœè¯é˜¶æ®µä¸­ï¼Œæ¯åç©å®¶å¯ä»¥è¡ŒåŠ¨äº”æ¬¡ï¼Œæœè¯é˜¶æ®µå¯èƒ½è·å¾—ä¹‹å‰æœªå‡ºç°è¿‡çš„çº¿ç´¢</p>
                    <p>3. æœè¯é˜¶æ®µç»“æŸåè¿›è¡Œè®¨è®ºï¼Œåœ¨æ‰‹ä¸­æ‹¥æœ‰è¯æ®çš„å‰æä¸‹ï¼Œç©å®¶å¯ä»¥å±•ç¤ºä¸€é¡¹è¯æ®å¹¶å‘è¨€ï¼Œæ‰€æœ‰ç©å®¶å…¨éƒ¨åœæ­¢å‘è¨€åï¼Œå°†è¿›è¡Œä¸€è½®æ€»ç»“å‘è¨€ï¼Œæ€»ç»“å‘è¨€ä¸­æ¯åç©å®¶ä»…å¯å‘è¨€ä¸€æ¬¡</p>
                    <p>4. å‘è¨€é˜¶æ®µç»“æŸåï¼Œå°†è¿›è¡ŒæŠ•ç¥¨</p>

                    <h4>æ¸¸æˆæ ¸å¿ƒç©æ³•</h4>
                    <p>1. æœ¬æ¸¸æˆä¸ºå¤šäººæ¨ç†ç±»æ¸¸æˆï¼Œé€šè¿‡æ¢ç´¢åœºæ™¯æ”¶é›†çº¿ç´¢</p>
                    <p>2. é™¤å»æ¢ç´¢åœºæ™¯å¤–ï¼Œä¸å…¶ä»–ç©å®¶ç›¸é‡ã€è·ç¦»æ€å®³ç°åœºè¾ƒè¿‘ç­‰æƒ…å†µä¸‹éƒ½å¯èƒ½è·å¾—æ–°çš„çº¿ç´¢</p>
                    <p>2. æ”¶é›†åˆ°çš„çº¿ç´¢å¯ä»¥åœ¨æ‰‹æœºä¸­æŸ¥çœ‹ï¼Œéœ€æ•´åˆçº¿ç´¢å®Œæˆæ¨ç†ï¼Œå¹¶æœ€ç»ˆç¥¨é€‰å‡ºé­”å¥³</p>

                    <h4>åŸºç¡€æ“ä½œè§„åˆ™</h4>
                    <p>1. è¿æ¥æœåŠ¡å™¨åï¼Œåœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹å¹¶å›è½¦/ç‚¹å‡»å‘é€å³å¯æ‰§è¡Œæ“ä½œ</p>
                    <p>2. å¯¹äºæ— åºå·çš„å†…å®¹ï¼Œè¾“å…¥æ•´ä¸ªæ–‡æœ¬ï¼Œå¯¹äºæœ‰åºå·çš„å†…å®¹ï¼Œåªéœ€è¾“å…¥åºå·</p>
                    <p>3. åœ°å›¾é¢æ¿å¯åˆ‡æ¢ä¸åŒæ¥¼å±‚ï¼ŒæŸ¥çœ‹å½“å‰åœºæ™¯å¸ƒå±€</p>

                    <h4>æ¸©é¦¨æç¤º</h4>
                    <p>1. æ‰€æœ‰æ“ä½œæŒ‡ä»¤éœ€ç¬¦åˆæ¸¸æˆå†…åœºæ™¯é€»è¾‘ï¼Œæ— æ•ˆæŒ‡ä»¤ä¼šæç¤ºé”™è¯¯</p>
                    <p>2. æ¸¸æˆè¿‡ç¨‹ä¸­ä¿æŒç½‘ç»œç¨³å®šï¼Œé¿å…æ•°æ®ä¼ è¾“å¼‚å¸¸</p>
                </div>
            </div>
        </div>
    </div>

    <div class="input-area">
        <label class="input-label">è¾“å…¥æŒ‡ä»¤:</label>
        <input type="text" class="input-box" id="inputBox" placeholder="è¾“å…¥æ¸¸æˆæŒ‡ä»¤ï¼Œå›è½¦å‘é€...">
        <button class="btn send-btn" id="sendBtn">å‘é€</button>
    </div>

    <div class="modal-overlay" id="configModal">
        <div class="modal-box">
            <h3 class="modal-title">æœåŠ¡å™¨é…ç½®</h3>
            <div class="form-item">
                <label class="form-label">æœåŠ¡å™¨IPåœ°å€</label>
                <input type="text" class="form-input" id="serverIp" value="127.0.0.1">
            </div>
            <div class="form-item">
                <label class="form-label">æœåŠ¡å™¨ç«¯å£</label>
                <input type="text" class="form-input" id="serverPort" value="9999">
            </div>
            <button class="modal-submit" id="confirmConfigBtn">ç¡®è®¤é…ç½®</button>
        </div>
    </div>

    <script>
        const MAP_PATHS = {
            "floor1": "./img/map_floor1.png",
            "floor2": "./img/map_floor2.png",
            "floorF1": "./img/map_floorF1.png",
            // å¤‡ç”¨æµ‹è¯•å›¾ï¼ˆ16:9æ ‡å‡†å°ºå¯¸ï¼ŒåŠ è½½å¤±è´¥è‡ªåŠ¨æ˜¾ç¤ºï¼Œä¿è¯åœ°å›¾ä¸ä¼šç©ºç™½ï¼‰
            test: "https://picsum.photos/1920/1080?random=1"
        };
        let isConnected = false;
        let currentHost = "127.0.0.1";
        let currentPort = 9999;
        let currentMap = "floor1";
        let ws = null;

        const statusText = document.getElementById("statusText");
        const configBtn = document.getElementById("configBtn");
        const messageContent = document.getElementById("messageContent");
        const mapSection = document.getElementById("mapSection");
        const mapTabs = document.getElementById("mapTabs");
        const mapDisplay = document.getElementById("mapDisplay");
        const inputBox = document.getElementById("inputBox");
        const sendBtn = document.getElementById("sendBtn");
        const configModal = document.getElementById("configModal");
        const serverIp = document.getElementById("serverIp");
        const serverPort = document.getElementById("serverPort");
        const confirmConfigBtn = document.getElementById("confirmConfigBtn");

        window.addEventListener("load", () => {
            loadMap(currentMap);
            bindEvents();
        });

        function bindEvents() {
            configBtn.addEventListener("click", () => {
                if (isConnected) {
                    disconnectServer();
                } else {
                    openConfigModal();
                }
            });

            mapTabs.querySelectorAll(".tab-btn").forEach(tab => {
                tab.addEventListener("click", () => {
                    mapTabs.querySelectorAll(".tab-btn").forEach(t => t.classList.remove("active"));
                    tab.classList.add("active");
                    currentMap = tab.dataset.map;
                    loadMap(currentMap);
                });
            });

            sendBtn.addEventListener("click", sendMessage);
            inputBox.addEventListener("keydown", (e) => {
                if (e.key === "Enter") sendMessage();
            });

            confirmConfigBtn.addEventListener("click", confirmConfig);

            configModal.addEventListener("click", (e) => {
                if (e.target === configModal) closeConfigModal();
            });

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && configModal.style.display === "flex") {
                    closeConfigModal();
                }
            });
        }

        // åœ°å›¾åŠ è½½é€»è¾‘ï¼šå®Œç¾é€‚é…16:9å®¹å™¨ï¼Œå›¾ç‰‡å±…ä¸­ä¸å˜å½¢ï¼ŒåŠ è½½å¤±è´¥è‡ªåŠ¨æ˜¾ç¤ºæµ‹è¯•å›¾
        function loadMap(mapKey) {
            mapDisplay.innerHTML = `<div class="map-ratio-16-9"><div class="map-error">æ­£åœ¨åŠ è½½åœ°å›¾...</div></div>`;
            const ratioBox = mapDisplay.querySelector('.map-ratio-16-9');
            const imgPath = MAP_PATHS[mapKey];
            const testImgPath = MAP_PATHS.test;
            const img = new Image();
            img.src = imgPath;
            img.className = "map-img";

            img.onload = () => {
                ratioBox.innerHTML = "";
                ratioBox.appendChild(img);
            };

            img.onerror = () => {
                ratioBox.innerHTML = "";
                const testImg = new Image();
                testImg.src = testImgPath;
                testImg.className = "map-img";
                testImg.onload = () => ratioBox.appendChild(testImg);
                addMessage(`âš ï¸ ${mapTabs.querySelector(`[data-map="${mapKey}"]`).textContent} åŠ è½½å¼‚å¸¸ï¼Œå·²æ˜¾ç¤ºæµ‹è¯•åœ°å›¾`, "error");
            };
        }

        function addMessage(msg, type = "default") {
            const colorMap = {
                self: "#5CA4D8",
                system: "#9C6CD3",
                success: "#64B89C",
                error: "#E76474",
                tip: "#E8B569",
                default: "#555555"
            };

            const msgItem = document.createElement("div");
            msgItem.className = "msg-item";
            msgItem.style.color = colorMap[type];
            msgItem.innerHTML = msg;

            messageContent.appendChild(msgItem);
            messageContent.scrollTop = messageContent.scrollHeight;
        }

        function openConfigModal() {
            serverIp.value = currentHost;
            serverPort.value = currentPort;
            configModal.style.display = "flex";
        }

        function closeConfigModal() {
            configModal.style.display = "none";
        }

        function confirmConfig() {
            const newHost = serverIp.value.trim();
            const newPort = serverPort.value.trim();

            if (!newHost) {
                alert("IPåœ°å€ä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            const portNum = parseInt(newPort);
            if (isNaN(portNum) || portNum < 1 || portNum > 65535) {
                alert("ç«¯å£å·å¿…é¡»æ˜¯1-65535çš„æ•´æ•°ï¼");
                return;
            }

            currentHost = newHost;
            currentPort = portNum;
            statusText.textContent = `å·²é…ç½®æœåŠ¡å™¨ ${currentHost}:${currentPort} | æœªè¿æ¥`;
            statusText.style.color = "#E785A6";
            addMessage(`âœ… æœåŠ¡å™¨é…ç½®å®Œæˆï¼š${currentHost}:${currentPort}`, "success");
            closeConfigModal();

            alert("ç‚¹å‡»ç¡®å®šå°è¯•è¿æ¥æœåŠ¡å™¨");
            connectServer();
        }

        function connectServer() {
            if (isConnected) {
                alert("å·²è¿æ¥æœåŠ¡å™¨ï¼Œæ— éœ€é‡å¤è¿æ¥ï¼");
                return;
            }
            ws = new WebSocket(`ws://${currentHost}:${currentPort}`);

            ws.onopen = () => {
                isConnected = true;
                configBtn.textContent = "æ–­å¼€è¿æ¥";
                statusText.textContent = `å·²è¿æ¥æœåŠ¡å™¨ ${currentHost}:${currentPort} | æ¸¸æˆä¸­`;
                statusText.style.color = "#8BC8E8";
                addMessage(`âœ… æˆåŠŸè¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨ ${currentHost}:${currentPort}ï¼`, "success");
                addMessage(`ğŸ’¡ å¯ä»¥å¼€å§‹è¾“å…¥æ¸¸æˆæŒ‡ä»¤å•¦ï¼`, "tip");
            };

            ws.onmessage = (event) => {
                const recvMsg = event.data.trim();
                if (!recvMsg) return;
                if (recvMsg.includes("ç³»ç»Ÿå…¬å‘Š") || recvMsg.includes("æ¸¸æˆç»“æŸ")) {
                    addMessage(recvMsg, "system");
                } else if (recvMsg.includes("æˆåŠŸ") || recvMsg.includes("è·å¾—") || recvMsg.includes("å·²åˆ°è¾¾")) {
                    addMessage(recvMsg, "success");
                } else if (recvMsg.includes("å¤±è´¥") || recvMsg.includes("æ­»äº¡") || recvMsg.includes("ä¸å¯")) {
                    addMessage(recvMsg, "error");
                } else if (recvMsg.includes("è¯·") || recvMsg.includes("è¾“å…¥") || recvMsg.includes("å¯é€‰")) {
                    addMessage(recvMsg, "tip");
                } else if (recvMsg) {
                    addMessage(recvMsg, "default");
                }
            };

            ws.onclose = () => {
                disconnectServer();
                addMessage("âš ï¸ æœåŠ¡å™¨è¿æ¥å·²æ–­å¼€ï¼ˆç½‘ç»œå¼‚å¸¸/æœåŠ¡å™¨å…³é—­ï¼‰", "error");
            };

            ws.onerror = (error) => {
                isConnected = false;
                configBtn.textContent = "è®¾ç½®æœåŠ¡å™¨";
                statusText.textContent = `è¿æ¥å¤±è´¥ ${currentHost}:${currentPort} | è¯·æ£€æŸ¥é…ç½®`;
                statusText.style.color = "#E785A6";
                addMessage(`âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼š${currentHost}:${currentPort}ï¼Œè¯·æ£€æŸ¥IP/ç«¯å£æˆ–æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨`, "error");
            };
        }

        function disconnectServer() {
            if (isConnected && ws) {
                ws.close();
                ws = null;
            }
            isConnected = false;
            configBtn.textContent = "è®¾ç½®æœåŠ¡å™¨";
            statusText.textContent = `å·²é…ç½®æœåŠ¡å™¨ ${currentHost}:${currentPort} | å·²æ–­å¼€`;
            statusText.style.color = "#E785A6";
            addMessage("âŒ å·²æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥", "error");
        }

        function sendMessage() {
            const msg = inputBox.value.trim();
            if (!msg) {
                alert("è¾“å…¥å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            if (!isConnected) {
                alert("è¯·å…ˆé…ç½®å¹¶è¿æ¥æœåŠ¡å™¨å†å‘é€æŒ‡ä»¤ï¼");
                return;
            }

            try {
                ws.send(msg + "\n");
                addMessage(`ä½ ï¼š${msg}`, "self");
                inputBox.value = "";
                inputBox.focus();
            } catch (e) {
                addMessage(`âŒ å‘é€æŒ‡ä»¤å¤±è´¥ï¼šè¿æ¥å·²æ–­å¼€ï¼Œè¯·é‡æ–°è¿æ¥`, "error");
            }
        }
    </script>
</body>

</html>
